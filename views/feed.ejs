<%- include("partials/header") %>

  <section id="feed-section" class="bg-zinc-900 w-full min-h-screen text-white p-5">

    <!-- STORIES -->
    <div class="story-container w-full flex gap-4 overflow-x-auto pb-3 scrollbar-hide">

      <% usersArray.forEach((user)=> { %>
        <div class="flex flex-col items-center cursor-pointer">
          <div
            class="h-20 w-20 rounded-full overflow-hidden border-2 border-pink-500 p-1 hover:scale-105 transition-all duration-200">
            <img src="/uploads/<%= user.profilePic %>" alt="story" class="h-full w-full rounded-full object-cover" />
          </div>
          <p class="text-xs mt-1 text-center opacity-80">
            <%= user.username %>
          </p>
        </div>
        <% }) %>

    </div>

    <!-- POSTS -->
    <div class="post-container flex flex-col gap-6 mt-6 mb-10">
      <% posts.forEach((post)=> { %>

        <div class="w-full bg-zinc-800 rounded-xl shadow-xl overflow-hidden">

          <!-- Post Image -->
          <div class="w-full h-[400px]">
            <img class="w-full h-full object-cover" src="/uploads/<%= post.postPic %>" alt="">
          </div>

          <!-- User + Caption -->
          <div class="p-4">
            <p class="text-sm text-gray-300">
              <span class="font-semibold text-white">
                <%= post.createdBy.username %>
              </span>
              <%= post.caption %>
            </p>
          </div>

          <!-- ACTION BUTTONS -->
          <div class="px-4 py-3 border-t border-zinc-700 flex items-center justify-between text-gray-300">

            <!-- LIKE -->
            <form action="/like/<%= post._id %>" method="POST">
              <button class="flex items-center gap-2 hover:text-white transition">
                <!-- Heart Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 
                   7.636l1.318-1.318a4.5 4.5 
                   0 116.364 6.364L12 21.364 4.318 
                   12.682a4.5 4.5 0 010-6.364z" />
                </svg>
                <span>
                  <%= post.likes.length %>
                </span>
              </button>
            </form>

            <!-- FOLLOW -->
            <form action="/toggle-follow/<%= post.createdBy._id %>" method="POST">
              <% if (user.following.includes(post.createdBy._id)) { %>
                <button class="bg-zinc-700 px-4 py-1 rounded text-white">Following</button>
                <% } else { %>
                  <button class="bg-blue-600 px-4 py-1 rounded text-white">Follow</button>
                  <% } %>
            </form>

            <!-- COMMENT -->
            <a href="/comment/<%= post._id %>" class="flex items-center gap-2 hover:text-white transition">
              <!-- Comment Icon -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M21 
                 12c0 4.418-4.03 8-9 8a9.86 
                 9.86 0 01-3.5-.6L3 21l1.6-4.3A8.3 
                 8.3 0 013 12c0-4.418 4.03-8 9-8s9 
                 3.582 9 8z" />
              </svg>
              <span>Comment</span>
            </a>

          </div>

        </div>

        <% }) %>
    </div>

  </section>

  <footer class="py-1 px-5 bg-zinc-700 text-white flex justify-between items-center fixed bottom-0 w-full">
    <a href="/feed">
      <i class="fa-solid fa-house text-xl"></i>
    </a>

    <a href="/create-post">
      <i class="fa-solid fa-plus text-xl"></i>
    </a>

    <a href="/profile">
      <div class="h-10 w-10 rounded-full overflow-hidden">
        <img class="h-full w-full object-cover" src="/uploads/<%= user.profilePic %>" alt="">
      </div>
    </a>
  </footer>

  <%- include("partials/footer") %>