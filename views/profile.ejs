<%- include("partials/header") %>

  <section id="profile-section" class="w-full min-h-screen bg-zinc-900 text-white pb-20">

    <!-- TOP FOLDER -->
    <div class="p-5">

      <!-- USER HEADER -->
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold drop-shadow-md">
          <%= user.name || user.username %>
        </h1>
        <a href="/logout" class="bg-red-600 px-4 py-1 rounded-lg hover:bg-red-500 transition">
          Logout
        </a>
      </div>

      <!-- PROFILE PIC + BIO -->
      <div class="flex flex-col justify-center items-center gap-4">

        <!-- PROFILE IMAGE -->
        <div class="h-32 w-32 rounded-full border-4 border-zinc-700 overflow-hidden shadow-xl">
          <% if (user.profilePic) { %>
            <img src="/uploads/<%= user.profilePic %>" class="h-full w-full object-cover">
            <% } else { %>
              <img src="/profile.jpg" class="h-full w-full object-cover">
              <% } %>
        </div>

        <!-- CHANGE PROFILE PIC -->
        <form action="/upload-profile" method="POST" enctype="multipart/form-data">
          <label class="bg-blue-600 px-4 py-1 rounded cursor-pointer hover:bg-blue-500 transition">
            Change Photo
            <input type="file" name="profilePic" class="hidden" onchange="this.form.submit()">
          </label>
        </form>

        <div class="text-center">
          <h2 class="text-xl font-semibold">
            <%= user.username %>
          </h2>
          <p class="text-zinc-400 text-sm mt-1">
            <%= user.bio || "No bio added" %>
          </p>
        </div>

        <!-- STATS -->
        <div class="flex gap-8 text-center mt-4">
          <div>
            <p class="text-2xl font-bold">
              <%= user.posts.length %>
            </p>
            <p class="text-zinc-400 text-sm">Posts</p>
          </div>
          <div>
            <p class="text-2xl font-bold">
              <%= user.followers.length %>
            </p>
            <p class="text-zinc-400 text-sm">Followers</p>
          </div>
          <div>
            <p class="text-2xl font-bold">
              <%= user.following.length %>
            </p>
            <p class="text-zinc-400 text-sm">Following</p>
          </div>
        </div>

        <!-- FOLLOW REQUESTS SECTION -->
        <% if (user.pendingRequests.length> 0) { %>
          <div class="mt-8 bg-zinc-800 p-4 rounded-xl w-full">
            <h3 class="text-lg font-semibold mb-3">Follow Requests</h3>

            <% user.pendingRequests.forEach(reqUser=> { %>
              <div class="flex justify-between items-center bg-zinc-700 px-3 py-2 rounded-lg mb-2">

                <span class="font-medium">
                  <%= reqUser.username %>
                </span>

                <div class="flex gap-2">
                  <!-- Accept Request -->
                  <form action="/accept-follow-request/<%= reqUser._id %>" method="POST">
                    <button class="bg-green-600 px-3 py-1 rounded hover:bg-green-500">
                      Accept
                    </button>
                  </form>

                  <!-- Reject Request -->
                  <form action="/reject-follow-request/<%= reqUser._id %>" method="POST">
                    <button class="bg-red-600 px-3 py-1 rounded hover:bg-red-500">
                      Reject
                    </button>
                  </form>
                </div>

              </div>
              <% }) %>
          </div>
          <% } %>

            <!-- EDIT PROFILE -->
            <a href="/edit-profile"
              class="mt-4 bg-zinc-800 border border-zinc-600 px-6 py-2 rounded-lg hover:bg-zinc-700 transition">
              Edit Profile
            </a>

      </div>
    </div>

    <!-- POSTS GRID -->
    <div class="px-4 grid grid-cols-3 gap-2 mt-6">
      <% if(user.posts.length===0) { %>
        <p class="text-center col-span-3 text-zinc-400">No posts yet</p>
        <% } %>

          <% user.posts.forEach(post=> { %>
            <div class="relative group h-40 rounded overflow-hidden">

              <img src="/uploads/<%= post.postPic %>"
                class="w-full h-full object-cover group-hover:opacity-70 transition">

              <!-- DELETE POST BUTTON -->
              <form action="/delete-post/<%= post._id %>" method="POST"
                class="absolute top-1 right-1 hidden group-hover:flex">
                <button class="bg-red-600 h-7 w-7 rounded-full flex items-center justify-center">
                  <i class="fa-solid fa-xmark text-white text-sm"></i>
                </button>
              </form>

            </div>
            <% }) %>
    </div>

  </section>

  <!-- BOTTOM NAVBAR -->
  <footer class="px-8 py-2 bg-zinc-950 text-white flex justify-between items-center fixed bottom-0 w-full">

    <a href="/feed" class="hover:text-blue-400">
      <i class="fa-solid fa-house text-2xl"></i>
    </a>

    <a href="/create-post" class="hover:text-blue-400">
      <i class="fa-solid fa-square-plus text-2xl"></i>
    </a>

    <a href="/profile" class="hover:opacity-80">
      <div class="h-9 w-9 rounded-full overflow-hidden border border-zinc-600">
        <% if (user.profilePic) { %>
          <img src="/uploads/<%= user.profilePic %>" class="h-full w-full object-cover">
          <% } else { %>
            <img src="/profile.jpg" class="h-full w-full object-cover">
            <% } %>
      </div>
    </a>

  </footer>

  <%- include("partials/footer") %>